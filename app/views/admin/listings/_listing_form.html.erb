<% action = (action_type == :new) ? admin_listings_url : admin_listing_url(listing) %>
<% method = (action_type == :new) ? :post : :patch %>
<% button_text = (action_type == :new) ? "Create Listing" : "Update Listing"%>

<%= render 'shared/errors' %>

<form class="admin-form" action="<%= action %>" method="POST">
  <input type="hidden" name="_method" value="<%= method %>">
  <%= auth_token %>
  <input
    type="radio"
    name="listing[type_of]"
    value="Rental"
    id="listing_rental"
    <%= listing.type_of == "Rental" ? "checked" : "" %>>
  <label for="listing_rental">Rental</label>
  <br>
  <input
    type="radio"
    name="listing[type_of]"
    value="Sale"
    id="listing_sale"
    <%= listing.type_of == "Sale" ? "checked" : "" %>>
  <label for="listing_sale">Sale</label>
  <br>
  <br>
  <label>Price:
    <input class="text-input" type="text" value="<%= listing.price %>" name="listing[price]">
  </label>
  <br>
  <br>
  <% address = (action_type == :new) ? "" : listing.address %>
  <label>Street Address:
    <input class="text-input" type="text" value="<%= address %>" name="street_address">
  </label>
  <br>
  <br>
  <% if (action_type == :new) %>
    <label>City (i.e. Brooklyn):
      <input class="text-input" type="text" value="" name="city">
    </label>
    <br>
    <br>
    <label>Zipcode:
      <input class="text-input" type="text" value="" name="zip">
    </label>
    <br>
    <br>
  <% end %>

  <label>Description:
    <textarea class="text-input" name="listing[description]"><%= listing.description %></textarea>
  </label>
  <br>
  <br>
  <p>Bedrooms:</p>
    <input
      type="radio"
      name="listing[bed_count]"
      value="1"
      id="listing_beds"
      <%= listing.bed_count == 1 ? "checked" : "" %>>
    <label for="listing_beds">1</label>
    <br>
    <input
      type="radio"
      name="listing[bed_count]"
      value="2"
      id="listing_beds"
      <%= listing.bed_count == 2 ? "checked" : "" %>>
    <label for="listing_beds">2</label>
    <br>
    <input
      type="radio"
      name="listing[bed_count]"
      value="3"
      id="listing_beds"
      <%= listing.type_of == 3 ? "checked" : "" %>>
    <label for="listing_beds">3</label>
    <br>
    <input
      type="radio"
      name="listing[bed_count]"
      value="4"
      id="listing_beds"
      <%= listing.bed_count == 4 ? "checked" : "" %>>
    <label for="listing_beds">4</label>
    <br>
    <br>
  <p>Bathrooms:</p>
    <input
      type="radio"
      name="listing[bath_count]"
      value="1"
      id="listing_baths"
      <%= listing.bath_count == 1 ? "checked" : "" %>>
    <label for="listing_baths">1</label>
    <br>
    <input
      type="radio"
      name="listing[bath_count]"
      value="2"
      id="listing_baths"
      <%= listing.bath_count == 2 ? "checked" : "" %>>
    <label for="listing_baths">2</label>
    <br>
    <input
      type="radio"
      name="listing[bath_count]"
      value="3"
      id="listing_baths"
      <%= listing.bath_count == 3 ? "checked" : "" %>>
    <label for="listing_baths">3</label>
    <br>
    <br>

  <p>Neighborhood:</p>
    <input
      type="radio"
      name="listing[neighborhood]"
      value="Ridgewood"
      id="listing_neighborhood"
      <%= listing.neighborhood == "Ridgewood" ? "checked" : "" %>>
    <label for="listing_neighborhood">Ridgewood</label>
    <br>
    <input
      type="radio"
      name="listing[neighborhood]"
      value="Bed-Stuy"
      id="listing_neighborhood"
      <%= listing.neighborhood == "Bed-Stuy" ? "checked" : "" %>>
    <label for="listing_neighborhood">Bed-Stuy</label>
    <br>
    <input
      type="radio"
      name="listing[neighborhood]"
      value="Clinton Hill"
      id="listing_neighborhood"
      <%= listing.neighborhood == "Clinton Hill" ? "checked" : "" %>>
    <label for="listing_neighborhood">Clinton Hill</label>
    <br>
    <input
      type="radio"
      name="listing[neighborhood]"
      value="Williamsburg"
      id="listing_neighborhood"
      <%= listing.neighborhood == "Williamsburg" ? "checked" : "" %>>
    <label for="listing_neighborhood">Williamsburg</label>
    <br>
    <input
      type="radio"
      name="listing[neighborhood]"
      value="Greenpoint"
      id="listing_neighborhood"
      <%= listing.neighborhood == "Greenpoint" ? "checked" : "" %>>
    <label for="listing_neighborhood">Greenpoint</label>
    <br>
    <br>

  <label>Featured?:
    <input type="checkbox" name="listing[featured]"
    <%= 'checked="true"' if listing.featured %>>
  </label>
  <br>

  <label>No fee?:
    <input type="checkbox" name="listing[no_fee]"
    <%= 'checked="true"' if listing.no_fee %>>
  </label>
  <br>

  <label>Exclusive?:
    <input type="checkbox" name="listing[exclusive]"
    <%= 'checked="true"' if listing.exclusive %>>
  </label>
  <br>

  <p>Broker:</p>
  <% Broker.all.each do |broker| %>
  <input
    type="radio"
    name="listing[broker]"
    value="<%= broker.id %>"
    id="listing_broker"
    <%= listing.brokers[0] == broker ? "checked" : "" %>>
  <label for="listing_broker"><%= broker.first_name %> <%= broker.last_name %></label>
  <br>
  <% end %>
  <br><br>

  <p>Main Photo:</p>
  <%= cl_image_upload_tag(:image) %>
  <span class="preview"></span>
  <div class="image_public_id"></div>
  <br><br>

  <p>Additional Photos:</p>
  <%= cl_image_upload_tag(:image_1) %>
  <%= cl_image_upload_tag(:image_2) %>
  <%= cl_image_upload_tag(:image_3) %>
  <%= cl_image_upload_tag(:image_4) %>
  <%= cl_image_upload_tag(:image_5) %>
  <br><br>

  <input type="submit" value="<%= button_text %>">
  <% if action_type == :edit %>
  <%= link_to "Delete Listing", admin_listing_url(listing), method: :delete, class: 'btn' %>
  <% end %>
</form>

<br>
<a class="back-to-listings" href="/admin/listings">Back to Listings</a>

<script src='/assets/jquery.cloudinary.js' type='text/javascript'></script>
<script>
  // window.onload = function () {
  $(document).ready(function () {
    $('.cloudinary-fileupload').cloudinary_fileupload({
      replaceFileInput: false
    });
  });
</script>
